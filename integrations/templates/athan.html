<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Masjid Prayer Board</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@500;700;900&family=Space+Grotesk:wght@600;700&display=swap" rel="stylesheet">
  <style>
    /* TV-first (10-foot) styling */
    :root{
      /* High-contrast dark theme for TVs */
      --bg:#06090f;            /* darker background */
      --panel:#0b1118;         /* darker panels for contrast */
      --border:rgba(255,255,255,0.18); /* slightly stronger borders */
      --ink:#f5f8fc;           /* near-white text */
      --muted:#a8bacb;         /* readable muted */
      --accent:#25d0c0;        /* vivid teal highlight */
      --radius:18px;

      /* TV type scale: large minimums + vh scaling so 100% zoom still reads big */
      --fs-xs:clamp(18px,1.8vh,28px);
      --fs-sm:clamp(22px,2.2vh,34px);
      --fs-md:clamp(28px,3.0vh,44px);
      --fs-lg:clamp(40px,4.2vh,58px);
      --fs-xl:clamp(96px,10.5vh,160px); /* main clock */
      --gap:clamp(16px,2.6vh,32px);
      --row-min-h:clamp(88px,10.5vh,180px);
      --ticker-h:clamp(64px,7vh,110px);
      --safe: max(env(safe-area-inset-left), 24px);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:var(--bg);
      color:var(--ink);
      font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      font-size:var(--fs-md); /* ensure baseline size is large */
      -webkit-text-size-adjust:100%;
      text-rendering:optimizeLegibility;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      overflow:hidden; /* prevent scroll on TVs/mobile */
    }

    /* Fit container and fixed-size canvas that we scale */
    #fit-root{width:100vw;height:100vh;overflow:hidden;background:var(--bg);display:flex;justify-content:flex-start;align-items:flex-start}
    #canvas{position:relative;width:100%;}

    .board{
      display:grid;grid-template-columns:1.7fr 1fr;gap:var(--gap);
      padding:calc(var(--gap) + var(--safe));
      height:calc(100% - var(--ticker-h));
      width:100%;
      box-sizing:border-box;
    }

    .left{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:var(--gap);
      display:grid;grid-template-rows:auto 1fr;
    }
    .left .hdr{
      display:grid;grid-template-columns:1fr 1fr 1fr;align-items:center;
      color:var(--muted);
      font-weight:800;text-transform:uppercase;letter-spacing:.08em;
      font-size:var(--fs-sm);
      padding:calc(var(--gap)/2) var(--gap);
      border-bottom:1px solid var(--border)
    }
    .rows{display:flex;flex-direction:column;gap:calc(var(--gap)/1.6);padding-top:calc(var(--gap)/1.6)}

    .trow{
      display:grid;grid-template-columns:1.1fr 0.9fr 0.9fr;align-items:center;
      padding:calc(var(--gap)/1.4) var(--gap);
      border-radius:14px;border:1px solid var(--border);
      background:rgba(255,255,255,0.02);
      min-height:var(--row-min-h);
    }
    .trow .pname{font-weight:900;letter-spacing:.02em;font-size:var(--fs-lg)}
    .trow .start-time,.trow .iq-time{font-weight:900;font-size:var(--fs-lg);justify-self:end}
    .trow.active{background:linear-gradient(180deg, rgba(37,208,192,0.25), rgba(37,208,192,0.10));border-color:var(--accent);}
    .trow.active .pname,.trow.active .start-time,.trow.active .iq-time{color:#cffffb;text-shadow:0 1px 0 rgba(255,255,255,0.35)}

    .right{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);padding:var(--gap);display:grid;grid-template-rows:auto auto 1fr auto;gap:var(--gap)}
    .r-top{display:flex;justify-content:space-between;align-items:flex-start}
    .r-top .datecity{font-weight:900;font-size:var(--fs-md)}
    .r-top .date{font-size:var(--fs-sm);color:var(--muted);margin-top:6px}

    .sunrow{display:flex;gap:var(--gap);color:var(--muted);font-size:var(--fs-sm)}
    .sunrow .card{border:1px solid var(--border);border-radius:12px;padding:calc(var(--gap)/1.6) var(--gap);background:rgba(255,255,255,0.02)}
    .sunrow .title{font-weight:800;text-transform:uppercase;letter-spacing:.08em}
    .sunrow .time{font-size:var(--fs-md);color:var(--ink);font-weight:900;margin-top:6px}

    .clock{display:grid;justify-items:center;border:1px solid var(--border);border-radius:14px;padding:calc(var(--gap)/1.2) var(--gap);background:rgba(255,255,255,0.02)}
    #clock-main{font-weight:900;font-size:var(--fs-xl);line-height:1;letter-spacing:.02em}
    #clock-ampm{color:var(--muted);font-weight:800;margin-top:6px;font-size:var(--fs-sm)}

    .next{border:1px solid var(--border);border-radius:14px;padding:var(--gap);background:rgba(255,255,255,0.02)}
    .next .label{color:var(--muted);text-transform:uppercase;font-weight:800;letter-spacing:.08em;font-size:var(--fs-sm)}
    .next .nname{font-weight:900;margin-top:8px;font-size:var(--fs-md)}
    .next .times{display:flex;gap:12px;align-items:baseline;color:var(--muted);font-size:var(--fs-sm)}
    .next .times .v{color:var(--ink);font-weight:900;font-size:var(--fs-md)}
    #countdown{margin-top:10px;color:var(--accent);font-weight:900;font-size:var(--fs-lg)}

    .tickerbar{position:absolute;left:0;right:0;bottom:0;background:var(--panel);border-top:1px solid var(--border);padding:0 var(--gap);height:var(--ticker-h);display:flex;align-items:center;font-weight:900;font-size:var(--fs-lg)}

    /* Accessibility: reduce motion if user prefers */
    @media (prefers-reduced-motion: reduce){
      *{animation:none !important;transition:none !important}
    }

    /* Height-based font scaling cutoffs */
    @media (max-height: 1357px){
      :root{
        --fs-xs:clamp(16px,1.6vh,24px);
        --fs-sm:clamp(20px,2.0vh,30px);
        --fs-md:clamp(24px,2.4vh,36px);
        --fs-lg:clamp(34px,3.6vh,50px);
        --fs-xl:clamp(84px,9.0vh,150px);
        --row-min-h:clamp(80px,9vh,170px);
        --gap:clamp(14px,2.2vh,28px);
        --ticker-h:clamp(56px,6.2vh,96px);
      }
    }
    @media (max-height: 1020px){
      :root{
        --fs-xs:clamp(14px,1.5vh,22px);
        --fs-sm:clamp(18px,1.9vh,26px);
        --fs-md:clamp(22px,2.2vh,32px);
        --fs-lg:clamp(30px,3.2vh,44px);
        --fs-xl:clamp(72px,8.0vh,132px);
        --row-min-h:clamp(72px,8.8vh,150px);
        --gap:clamp(12px,2.0vh,24px);
        --ticker-h:clamp(52px,6.0vh,88px);
      }
    }
    @media (max-height: 800px){
      :root{
        --fs-xs:clamp(12px,1.4vh,20px);
        --fs-sm:clamp(16px,1.8vh,22px);
        --fs-md:clamp(18px,2.0vh,28px);
        --fs-lg:clamp(24px,2.8vh,36px);
        --fs-xl:clamp(56px,7.0vh,110px);
        --row-min-h:clamp(64px,8.2vh,132px);
        --gap:clamp(10px,1.8vh,20px);
        --ticker-h:clamp(48px,5.5vh,80px);
      }
    }
  </style>
</head>
<body>
  <div id="fit-root">
    <div id="canvas">
      <div class="board">
        <div class="left">
          <div class="hdr">
            <div>Salah</div>
            <div style="text-align:right">Starts</div>
            <div style="text-align:right">Iqamah</div>
          </div>
          <div class="rows">
            {{range .Prayers}}
            <div class="trow" data-name="{{.Name}}" data-athan="{{.Time}} {{.Period}}">
              <div class="pname">{{.Name}}</div>
              <div class="start-time">{{.Time}} {{.Period}}</div>
              <div class="iq-time"></div>
            </div>
            {{end}}
          </div>
        </div>

        <div class="right">
          <div class="r-top">
            <div class="datecity">
              <div class="city">{{.City}}</div>
              <div class="date">{{.Date}}</div>
            </div>
            <div class="sunrow">
              <div class="card">
                <div class="title">Sunrise</div>
                <div class="time">—</div>
              </div>
              <div class="card">
                <div class="title">Ishraq</div>
                <div class="time">—</div>
              </div>
            </div>
          </div>

          <div class="clock">
            <div id="clock-main">--:--</div>
            <div id="clock-ampm"></div>
          </div>

          <div class="next">
            <div class="label">Next Iqamah In</div>
            <div id="countdown">--:--</div>
            <div class="nname" id="spot-name">—</div>
            <div class="times">
              <div>Athan</div>
              <div class="v" id="spot-athan">--:--</div>
              <div class="v" id="spot-athan-ampm"></div>
              <div style="margin-left:16px">Iqamah</div>
              <div class="v" id="spot-iqama">--:--</div>
              <div class="v" id="spot-iqama-ampm"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="tickerbar" id="ticker" style="display:none"></div>
    </div>
  </div>

  <script>
    // Fit-to-viewport scaling: keep 1920x1080 canvas fully in view
    (function(){
      var canvas = document.getElementById('canvas');
      var fitRoot = document.getElementById('fit-root');
      function fit(){
        if(!canvas || !fitRoot) return;
        var baseW = 1920, baseH = 1080;
        // Compute scale to fill width
        var scale = fitRoot.clientWidth / baseW;
        // Make the canvas element itself occupy the full width so there is no empty space in layout
        canvas.style.width = fitRoot.clientWidth + 'px';
        canvas.style.height = Math.round(baseH * scale) + 'px';
        // Render at 1:1 since we resized the element; no transform needed
        canvas.style.transform = 'none';
      }
      window.addEventListener('resize', fit);
      document.addEventListener('DOMContentLoaded', fit);
      fit();
    })();

    // ---------- Utilities ----------
    function parseTime12hToDate(timeStr){
      var m = String(timeStr).trim().match(/^(\d{1,2}):(\d{2})\s*(AM|PM)$/i);
      if(!m) return null;
      var h = parseInt(m[1],10), min = parseInt(m[2],10);
      var ap = m[3].toUpperCase();
      if(ap==="PM" && h!==12) h+=12;
      if(ap==="AM" && h===12) h=0;
      var d = new Date();
      d.setHours(h, min, 0, 0);
      return d;
    }
    function formatTime12h(d){
      var h = d.getHours(), m = d.getMinutes();
      var ap = h>=12 ? 'PM' : 'AM';
      h = h%12 || 12;
      return { main: (h+':' + String(m).padStart(2,'0')), ampm: ap };
    }
    function addMinutes(d, mins){ return new Date(d.getTime() + mins*60000); }

    document.addEventListener('DOMContentLoaded', function(){
      var rows = Array.from(document.querySelectorAll('.trow'));
      // Populate Iqamah (Athan + 5)
      rows.forEach(function(row){
        var athanStr = row.getAttribute('data-athan');
        var d = parseTime12hToDate(athanStr);
        var iq = d ? addMinutes(d, 5) : null;
        var iqEl = row.querySelector('.iq-time');
        if(iq && iqEl){ var f = formatTime12h(iq); iqEl.textContent = f.main + ' ' + f.ampm; }
      });

      // Live clock
      function updateClock(){ var now = new Date(); var f = formatTime12h(now); document.getElementById('clock-main').textContent = f.main; document.getElementById('clock-ampm').textContent = f.ampm; }
      updateClock(); setInterval(updateClock, 1000);

      // Next prayer + countdown
      function getNextPrayer(){
        var items = rows.map(function(r){
          return { row:r, name:r.getAttribute('data-name'), athan:parseTime12hToDate(r.getAttribute('data-athan')) };
        }).filter(function(x){ return !!x.athan; }).sort(function(a,b){ return a.athan-b.athan; });
        var now = new Date();
        var afterNow = items.find(function(x){ return x.athan > now; });
        if(afterNow) return afterNow;
        return items.length ? { row: items[0].row, name: items[0].name, athan: addMinutes(items[0].athan, 24*60) } : null;
      }

      var next = getNextPrayer();
      if(next){
        rows.forEach(function(r){ r.classList.remove('active'); });
        next.row.classList.add('active');

        var base = parseTime12hToDate(next.row.getAttribute('data-athan'));
        var iq = addMinutes(base, 5);
        var fA = formatTime12h(base);
        var fI = formatTime12h(iq);
        document.getElementById('spot-name').textContent = next.name;
        document.getElementById('spot-athan').textContent = fA.main;
        document.getElementById('spot-athan-ampm').textContent = fA.ampm;
        document.getElementById('spot-iqama').textContent = fI.main;
        document.getElementById('spot-iqama-ampm').textContent = fI.ampm;

        var countdownEl = document.getElementById('countdown');
        function tick(){
          var now2 = new Date(); var diff = iq.getTime() - now2.getTime();
          var upcoming = diff>=0; diff = Math.abs(diff);
          var h=Math.floor(diff/3600000), m=Math.floor((diff%3600000)/60000), s=Math.floor((diff%60000)/1000);
          countdownEl.textContent = upcoming ? ('Next Iqamah in ' + (h>0?(h+'h '):'') + m + 'm ' + String(s).padStart(2,'0') + 's') : 'Iqamah started';
        }
        tick(); setInterval(tick, 1000);
      }

      // Optional ticker example: set message to show
      var ticker=document.getElementById('ticker'); var msg=''; if(msg){ticker.textContent=msg; ticker.style.display='flex';}
    });
  </script>
</body>
</html>
